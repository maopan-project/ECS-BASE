{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/ecs/systems/MoveSystem.ts"],"names":["MoveSystem","TransformComponent","SystemType","NetworkReceiveComponent","MoveComponent","world","type","Physics","onUpdate","msgOp","getSingletonEntityComponent","msgThisLogic","operations","i","length","op","entity","getEntityByID","entityID","getComponent","moveSpeed","set","body","dir","x","y","z","forEach","move","transform","multiply","position","add"],"mappings":";;;uJAWaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAXJC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,U,iBAAAA,U;;AAIFC,MAAAA,uB;;AAEAC,MAAAA,a;;;;;;;;;4BAIMJ,U,GAAN,MAAMA,UAAN,CAAmC;AAAA;AAAA,eACtCK,KADsC,GACvB,IADuB;AAAA,eAGtCC,IAHsC,GAGnB;AAAA;AAAA,wCAAWC,OAHQ;AAAA;;AAKtCC,QAAAA,QAAQ,GAAS;AACb,cAAIC,KAAK,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAZ;;AAEA,cAAID,KAAK,CAACE,YAAV,EAAwB;AACpB,gBAAIC,UAAU,GAAGH,KAAK,CAACE,YAAN,CAAmBC,UAApC;;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAIE,EAAE,GAAGH,UAAU,CAACC,CAAD,CAAnB;AACA,kBAAIG,MAAM,GAAG,KAAKX,KAAL,CAAWY,aAAX,CAAyBF,EAAE,CAACG,QAA5B,CAAb;;AACA,kBAAIF,MAAJ,EAAY;AACRA,gBAAAA,MAAM,CAACG,YAAP;AAAA;AAAA,oDAAmCC,SAAnC,CAA6CC,GAA7C,CAAiDN,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYC,CAA7D,EAAgET,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYE,CAA5E,EAA+EV,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYG,CAA3F;AACH;AACJ;AACJ;;AAED,eAAKrB,KAAL,CAAWsB,OAAX,CAAmB;AAAA;AAAA;AAAA;AAAA,uDAAnB,EAAwD,CAACX,MAAD,EAAiBY,IAAjB,EAAsCC,SAAtC,KAAwE;AAC5HD,YAAAA,IAAI,CAACR,SAAL,CAAeU,QAAf,CAAwB,EAAxB;AACAD,YAAAA,SAAS,CAACE,QAAV,CAAmBC,GAAnB,CAAuBJ,IAAI,CAACR,SAA5B;AACH,WAHD;AAIH;;AAvBqC,O","sourcesContent":["import { TransformComponent } from \"../components/TransformComponent\";\r\nimport { SystemType } from \"../framework/ECSConfig\";\r\nimport { Entity } from \"../framework/Entity\";\r\nimport { System } from \"../framework/System\";\r\nimport { World } from \"../framework/World\";\r\nimport NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport { GameMessageOperationBody } from \"../../network/GameMessage\";\r\nimport MoveComponent from \"../components/MoveCompoent\";\r\nimport { log } from \"cc\";\r\n\r\n\r\nexport class MoveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.Physics;\r\n\r\n    onUpdate(): void {\r\n        let msgOp = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        if (msgOp.msgThisLogic) {\r\n            let operations = msgOp.msgThisLogic.operations;\r\n            for (let i = 0; i < operations.length; i++) {\r\n                let op = operations[i];\r\n                let entity = this.world.getEntityByID(op.entityID);\r\n                if (entity) {\r\n                    entity.getComponent(MoveComponent).moveSpeed.set(op.body.dir.x, op.body.dir.y, op.body.dir.z);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.world.forEach([MoveComponent, TransformComponent], (entity: Entity, move: MoveComponent, transform: TransformComponent) => {\r\n            move.moveSpeed.multiply(10);\r\n            transform.position.add(move.moveSpeed);\r\n        });\r\n    }\r\n} "]}