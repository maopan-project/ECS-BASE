{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/network/GameMessage.ts"],"names":["MessagePool","GameMessageBase","GameMessageC2S_GameStart","GameMessageS2C_GameStart","GameMessageS2C_UID","GameMessageC2S_Operation","GameMessageOperationBody","GameMessageS2C_Operations","Vector3","get","msg","type","prototype","msgs","has","set","arr","length","pop","recycle","clear","push","clearAll","values","forEach","Map","GameMessageType","C2S_GAME_START","S2C_GAME_START","uids","S2C_UID","uid","C2S_OPERATOR","body","entityID","dir","S2C_OPERATIONS","operations"],"mappings":"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","sourcesContent":["import { Scheduler } from \"cc\";\r\nimport { Vector3 } from \"../Type\";\r\n\r\nexport class MessagePool {\r\n    private static msgs: Map<GameMessageType, GameMessageBase[]> = new Map();\r\n\r\n    public static get<T extends GameMessageBase>(msg: { prototype: T, new(): T }): T {\r\n        let type = msg.prototype.type;\r\n\r\n        if (!MessagePool.msgs.has(type)) {\r\n            MessagePool.msgs.set(type, []);\r\n        }\r\n\r\n        let arr = MessagePool.msgs.get(type);\r\n\r\n        if (arr.length > 0) {\r\n            return arr.pop() as T;\r\n\r\n        } else {\r\n            return new msg();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    public static recycle<T extends GameMessageBase>(msg: T) {\r\n        if (MessagePool.msgs.has(msg.type)) {\r\n            let arr = MessagePool.msgs.get(msg.type);\r\n            msg.clear();\r\n            arr.push(msg);\r\n        }\r\n    }\r\n\r\n    public static clearAll() {\r\n        for (const msgs of MessagePool.msgs.values()) {\r\n            msgs.forEach((msg => {\r\n                msg.clear();\r\n            }));\r\n        }\r\n\r\n        this.msgs.clear();\r\n    }\r\n}\r\n\r\nexport class GameMessageBase {\r\n    declare type: GameMessageType;\r\n    clear() { }\r\n}\r\n\r\nexport enum GameMessageType {\r\n    C2S_GAME_START,\r\n    C2S_OPERATOR,\r\n    S2C_UID,\r\n    S2C_GAME_START,\r\n    S2C_OPERATIONS,\r\n}\r\n\r\nexport class GameMessageC2S_GameStart extends GameMessageBase {\r\n    type: GameMessageType = GameMessageType.C2S_GAME_START;\r\n}\r\n\r\nexport class GameMessageS2C_GameStart extends GameMessageBase {\r\n    type: GameMessageType = GameMessageType.S2C_GAME_START;\r\n    uids: number[] = [];\r\n\r\n    clear(): void {\r\n        this.uids.length = 0;\r\n    }\r\n}\r\n\r\nexport class GameMessageS2C_UID extends GameMessageBase {\r\n    type: GameMessageType = GameMessageType.S2C_UID;\r\n    uid: number = -1;\r\n}\r\n\r\nexport class GameMessageC2S_Operation extends GameMessageBase {\r\n    type: GameMessageType = GameMessageType.C2S_OPERATOR;\r\n    uid: number = -1;\r\n    body: GameMessageOperationBody = new GameMessageOperationBody();\r\n    entityID: number = -1;\r\n}\r\n\r\nexport class GameMessageOperationBody {\r\n    dir: Vector3 = new Vector3();\r\n}\r\n\r\nexport class GameMessageS2C_Operations extends GameMessageBase {\r\n    type: GameMessageType = GameMessageType.S2C_OPERATIONS;\r\n    operations: GameMessageC2S_Operation[] = [];\r\n\r\n    clear(): void {\r\n        this.operations.length = 0;\r\n    }\r\n}\r\n\r\n"]}