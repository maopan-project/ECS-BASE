{"version":3,"sources":["file:///F:/ACode/CocosCode/ECS_Demo/assets/src/ecs/systems/NetwrokReciveSystem.ts"],"names":["NetworkReceiveSystem","NetworkReceiveComponent","SystemType","world","type","LogicBeforePhysics","onUpdate","nrc","getSingletonEntityComponent","msgThisLogic","rate","fixedUpdateInterval","networkUpdateInterval","frameToDealThisMsg","Math","floor","logicCycleCount","dealIndex","msgToDeal"],"mappings":";;;mEAKqBA,oB;;;;;;;;;;;;;;;;;;;;;;;;;;AALdC,MAAAA,uB;;AACEC,MAAAA,U,iBAAAA,U;;;;;;;yBAIYF,oB,GAAN,MAAMA,oBAAN,CAA6C;AAAA;AAAA,eACxDG,KADwD,GACzC,IADyC;AAAA,eAGxDC,IAHwD,GAGrC;AAAA;AAAA,wCAAWC,kBAH0B;AAAA;;AAKxDC,QAAAA,QAAQ,GAAS;AACb,cAAIC,GAAG,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAV;AAEAD,UAAAA,GAAG,CAACE,YAAJ,GAAmB,IAAnB;AAEA,cAAIC,IAAI,GAAG,KAAKP,KAAL,CAAWQ,mBAAX,GAAiC,KAAKR,KAAL,CAAWS,qBAAvD;AACA,cAAIC,kBAAkB,GAAGC,IAAI,CAACC,KAAL,CAAW,CAAC,KAAKZ,KAAL,CAAWa,eAAX,GAA6B,CAA9B,IAAmCN,IAA9C,IAAsD,CAA/E;;AAEA,cAAIG,kBAAkB,GAAGN,GAAG,CAACU,SAA7B,EAAwC;AAAC;AACrCV,YAAAA,GAAG,CAACE,YAAJ,GAAmBF,GAAG,CAACW,SAAJ,CAAcX,GAAG,CAACU,SAAJ,EAAd,CAAnB;AACH;AAEJ;;AAjBuD,O","sourcesContent":["import NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport { SystemType } from \"../framework/ECSConfig\";\r\nimport System from \"../framework/System\";\r\nimport World from \"../framework/World\";\r\n\r\nexport default class NetworkReceiveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.LogicBeforePhysics;\r\n\r\n    onUpdate(): void {\r\n        let nrc = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        nrc.msgThisLogic = null;\r\n\r\n        let rate = this.world.fixedUpdateInterval / this.world.networkUpdateInterval;\r\n        let frameToDealThisMsg = Math.floor((this.world.logicCycleCount - 1) * rate) + 1;\r\n\r\n        if (frameToDealThisMsg > nrc.dealIndex) {// 有新的网络包就更新一些\r\n            nrc.msgThisLogic = nrc.msgToDeal[nrc.dealIndex++];\r\n        }\r\n\r\n    }\r\n\r\n}"]}