{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/ecs/systems/NetwrokReciveSystem.ts"],"names":["NetworkReceiveSystem","log","NetworkReceiveComponent","SystemType","world","type","Network","onUpdate","nrc","getSingletonEntityComponent","msgThisLogic","rate","fixedUpdateInterval","networkUpdateInterval","frameToDealThisMsg","Math","floor","logicCycleCount","dealIndex","msgToDeal","JSON","stringify"],"mappings":";;;yHAMqBA,oB;;;;;;;;;;;;;;;;;;;;;;;;;;;AANZC,MAAAA,G,OAAAA,G;;AACFC,MAAAA,uB;;AACEC,MAAAA,U,iBAAAA,U;;;;;;;;;yBAIYH,oB,GAAN,MAAMA,oBAAN,CAA6C;AAAA;AAAA,eACxDI,KADwD,GACzC,IADyC;AAAA,eAGxDC,IAHwD,GAGrC;AAAA;AAAA,wCAAWC,OAH0B;AAAA;;AAKxDC,QAAAA,QAAQ,GAAS;AACb,cAAIC,GAAG,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAV;AAEAD,UAAAA,GAAG,CAACE,YAAJ,GAAmB,IAAnB;AAEA,cAAIC,IAAI,GAAG,KAAKP,KAAL,CAAWQ,mBAAX,GAAiC,KAAKR,KAAL,CAAWS,qBAAvD;AACA,cAAIC,kBAAkB,GAAGC,IAAI,CAACC,KAAL,CAAW,CAAC,KAAKZ,KAAL,CAAWa,eAAX,GAA6B,CAA9B,IAAmCN,IAA9C,IAAsD,CAA/E;;AAEA,cAAIG,kBAAkB,GAAGN,GAAG,CAACU,SAA7B,EAAwC;AAAC;AACrCV,YAAAA,GAAG,CAACE,YAAJ,GAAmBF,GAAG,CAACW,SAAJ,CAAcX,GAAG,CAACU,SAAJ,EAAd,CAAnB;AAEAjB,YAAAA,GAAG,CAACmB,IAAI,CAACC,SAAL,CAAeb,GAAG,CAACE,YAAnB,CAAD,CAAH;AACH;AAEJ;;AAnBuD,O","sourcesContent":["import { log } from \"cc\";\r\nimport NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport { SystemType } from \"../framework/ECSConfig\";\r\nimport { System } from \"../framework/System\";\r\nimport { World } from \"../framework/World\";\r\n\r\nexport default class NetworkReceiveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.Network;\r\n\r\n    onUpdate(): void {\r\n        let nrc = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        nrc.msgThisLogic = null;\r\n\r\n        let rate = this.world.fixedUpdateInterval / this.world.networkUpdateInterval;\r\n        let frameToDealThisMsg = Math.floor((this.world.logicCycleCount - 1) * rate) + 1;\r\n\r\n        if (frameToDealThisMsg > nrc.dealIndex) {// 有新的网络包就更新一下\r\n            nrc.msgThisLogic = nrc.msgToDeal[nrc.dealIndex++];\r\n\r\n            log(JSON.stringify(nrc.msgThisLogic));\r\n        }\r\n\r\n    }\r\n\r\n}"]}