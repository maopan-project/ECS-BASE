{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/ecs/systems/MoveSystem.ts"],"names":["MoveSystem","TransformComponent","SystemType","NetworkReceiveComponent","world","type","Physics","onUpdate","msgOp","getSingletonEntityComponent","msgThisLogic","operations","length","forEach","entity","transform","i","op","entityID","id","position","add","body","dir"],"mappings":";;;wIAWaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAVJC,MAAAA,kB,iBAAAA,kB;;AAEAC,MAAAA,U,iBAAAA,U;;AAIFC,MAAAA,uB;;;;;;;;;4BAIMH,U,GAAN,MAAMA,UAAN,CAAmC;AAAA;AAAA,eACtCI,KADsC,GACvB,IADuB;AAAA,eAGtCC,IAHsC,GAGnB;AAAA;AAAA,wCAAWC,OAHQ;AAAA;;AAKtCC,QAAAA,QAAQ,GAAS;AACb,cAAIC,KAAK,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAZ;;AAEA,cAAI,CAACD,KAAK,CAACE,YAAP,IAAuBF,KAAK,CAACE,YAAN,CAAmBC,UAAnB,CAA8BC,MAA9B,IAAwC,CAAnE,EAAsE;AAClE;AACH;;AAED,eAAKR,KAAL,CAAWS,OAAX,CAAmB;AAAA;AAAA,uDAAnB,EAAyC,CAACC,MAAD,EAAiBC,SAAjB,KAAmD;AACxF,gBAAIJ,UAAU,GAAGH,KAAK,CAACE,YAAN,CAAmBC,UAApC;;AAEA,iBAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,UAAU,CAACC,MAA/B,EAAuCI,CAAC,EAAxC,EAA4C;AACxC,kBAAIC,EAAE,GAAGN,UAAU,CAACK,CAAD,CAAnB;;AAEA,kBAAIC,EAAE,CAACC,QAAH,IAAeJ,MAAM,CAACK,EAA1B,EAA8B;AAC1BJ,gBAAAA,SAAS,CAACK,QAAV,CAAmBC,GAAnB,CAAuBJ,EAAE,CAACK,IAAH,CAAQC,GAA/B;AACH;AACJ;AACJ,WAVD;AAWH;;AAvBqC,O","sourcesContent":["import { misc } from \"cc\";\r\nimport { TransformComponent } from \"../components/TransformComponent\";\r\nimport { pForAngle } from \"../../Tool\";\r\nimport { SystemType } from \"../framework/Config\";\r\nimport { Entity } from \"../framework/Entity\";\r\nimport { System } from \"../framework/System\";\r\nimport { World } from \"../framework/World\";\r\nimport NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport { GameMessageOperationBody } from \"../../network/GameMessage\";\r\n\r\n\r\nexport class MoveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.Physics;\r\n\r\n    onUpdate(): void {\r\n        let msgOp = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        if (!msgOp.msgThisLogic || msgOp.msgThisLogic.operations.length == 0) {\r\n            return;\r\n        }\r\n\r\n        this.world.forEach([TransformComponent], (entity: Entity, transform: TransformComponent) => {\r\n            let operations = msgOp.msgThisLogic.operations;\r\n\r\n            for (let i = 0; i < operations.length; i++) {\r\n                let op = operations[i];\r\n\r\n                if (op.entityID == entity.id) {\r\n                    transform.position.add(op.body.dir);\r\n                }\r\n            }\r\n        });\r\n    }\r\n} "]}