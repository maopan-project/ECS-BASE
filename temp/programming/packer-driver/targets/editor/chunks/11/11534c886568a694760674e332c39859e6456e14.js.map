{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/ecs/systems/MoveSystem.ts"],"names":["MoveSystem","TransformComponent","SystemType","NetworkReceiveComponent","MoveComponent","world","type","Physics","onUpdate","msgOp","getSingletonEntityComponent","msgThisLogic","operations","i","length","op","entity","getEntityByID","entityID","moveComp","getComponent","transformComp","moveSpeed","set","body","dir","x","y","z","position","add"],"mappings":";;;sGAUaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAVJC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,U,iBAAAA,U;;AAIFC,MAAAA,uB;;AAEAC,MAAAA,a;;;;;;;4BAGMJ,U,GAAN,MAAMA,UAAN,CAAmC;AAAA;AAAA,eACtCK,KADsC,GACvB,IADuB;AAAA,eAGtCC,IAHsC,GAGnB;AAAA;AAAA,wCAAWC,OAHQ;AAAA;;AAKtCC,QAAAA,QAAQ,GAAS;AACb,cAAIC,KAAK,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAZ;;AAEA,cAAID,KAAK,CAACE,YAAV,EAAwB;AACpB,gBAAIC,UAAU,GAAGH,KAAK,CAACE,YAAN,CAAmBC,UAApC;;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAIE,EAAE,GAAGH,UAAU,CAACC,CAAD,CAAnB;AACA,kBAAIG,MAAM,GAAG,KAAKX,KAAL,CAAWY,aAAX,CAAyBF,EAAE,CAACG,QAA5B,CAAb;;AACA,kBAAIF,MAAJ,EAAY;AACR,oBAAIG,QAAQ,GAAGH,MAAM,CAACI,YAAP;AAAA;AAAA,mDAAf;AACA,oBAAIC,aAAa,GAAGL,MAAM,CAACI,YAAP;AAAA;AAAA,6DAApB,CAFQ,CAGR;;AACAD,gBAAAA,QAAQ,CAACG,SAAT,CAAmBC,GAAnB,CAAuBR,EAAE,CAACS,IAAH,CAAQC,GAAR,CAAYC,CAAnC,EAAsCX,EAAE,CAACS,IAAH,CAAQC,GAAR,CAAYE,CAAlD,EAAqDZ,EAAE,CAACS,IAAH,CAAQC,GAAR,CAAYG,CAAjE;AACAP,gBAAAA,aAAa,CAACQ,QAAd,CAAuBC,GAAvB,CAA2BX,QAAQ,CAACG,SAApC;AACH;AACJ;AACJ,WAhBY,CAkBb;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACH;;AApCqC,O","sourcesContent":["import { TransformComponent } from \"../components/TransformComponent\";\r\nimport { SystemType } from \"../framework/ECSConfig\";\r\nimport { Entity } from \"../framework/Entity\";\r\nimport { System } from \"../framework/System\";\r\nimport { World } from \"../framework/World\";\r\nimport NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport { GameMessageOperationBody } from \"../../network/GameMessage\";\r\nimport MoveComponent from \"../components/MoveCompoent\";\r\n\r\n\r\nexport class MoveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.Physics;\r\n\r\n    onUpdate(): void {\r\n        let msgOp = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        if (msgOp.msgThisLogic) {\r\n            let operations = msgOp.msgThisLogic.operations;\r\n            for (let i = 0; i < operations.length; i++) {\r\n                let op = operations[i];\r\n                let entity = this.world.getEntityByID(op.entityID);\r\n                if (entity) {\r\n                    let moveComp = entity.getComponent(MoveComponent);\r\n                    let transformComp = entity.getComponent(TransformComponent);\r\n                    // 这里的方向还应该乘上移动速度\r\n                    moveComp.moveSpeed.set(op.body.dir.x, op.body.dir.y, op.body.dir.z);\r\n                    transformComp.position.add(moveComp.moveSpeed);\r\n                }\r\n            }\r\n        }\r\n\r\n        // this.world.forEach([MoveComponent, TransformComponent], (entity: Entity, move: MoveComponent, transform: TransformComponent) => {\r\n        //     let operations = msgOp.msgThisLogic.operations;\r\n\r\n        //     for (let i = 0; i < operations.length; i++) {\r\n        //         let op = operations[i];\r\n\r\n        //         if (op.entityID == entity.id) {\r\n        //             // 这里的方向还应该乘上移动速度\r\n        //             move.moveSpeed.set(op.body.dir.x, op.body.dir.y, op.body.dir.z);\r\n        //             transform.position.add(move.moveSpeed);\r\n        //         }\r\n        //     }\r\n        // });\r\n    }\r\n} "]}