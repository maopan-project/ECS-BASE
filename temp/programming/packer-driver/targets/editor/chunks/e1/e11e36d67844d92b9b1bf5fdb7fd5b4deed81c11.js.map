{"version":3,"sources":["file:///F:/ACode/CocosCode/ECS_Demo/assets/src/ecs/systems/MoveSystem.ts"],"names":["MoveSystem","MoveComponent","NetworkReceiveComponent","TransformComponent","SystemType","world","type","Physics","onUpdate","msgOp","getSingletonEntityComponent","msgThisLogic","operations","i","length","op","entity","getEntityByID","entityID","getComponent","moveSpeed","set","body","dir","x","y","z","forEach","move","transform","position","add"],"mappings":";;;sGASaA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AATNC,MAAAA,a;;AACAC,MAAAA,uB;;AACAC,MAAAA,kB;;AACEC,MAAAA,U,iBAAAA,U;;;;;;;4BAMIJ,U,GAAN,MAAMA,UAAN,CAAmC;AAAA;AAAA,eACtCK,KADsC,GACvB,IADuB;AAAA,eAGtCC,IAHsC,GAGnB;AAAA;AAAA,wCAAWC,OAHQ;AAAA;;AAKtCC,QAAAA,QAAQ,GAAS;AACb,cAAIC,KAAK,GAAG,KAAKJ,KAAL,CAAWK,2BAAX;AAAA;AAAA,iEAAZ;;AAEA,cAAID,KAAK,CAACE,YAAV,EAAwB;AACpB,gBAAIC,UAAU,GAAGH,KAAK,CAACE,YAAN,CAAmBC,UAApC;;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,UAAU,CAACE,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAIE,EAAE,GAAGH,UAAU,CAACC,CAAD,CAAnB;AACA,kBAAIG,MAAM,GAAG,KAAKX,KAAL,CAAWY,aAAX,CAAyBF,EAAE,CAACG,QAA5B,CAAb;;AACA,kBAAIF,MAAJ,EAAY;AACRA,gBAAAA,MAAM,CAACG,YAAP;AAAA;AAAA,oDAAmCC,SAAnC,CAA6CC,GAA7C,CACIN,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYC,CAAZ,GAAgB,CADpB,EAEIT,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYE,CAAZ,GAAgB,CAFpB,EAGIV,EAAE,CAACO,IAAH,CAAQC,GAAR,CAAYG,CAAZ,GAAgB,CAHpB;AAIH;AACJ;AACJ;;AAED,eAAKrB,KAAL,CAAWsB,OAAX,CAAmB;AAAA;AAAA;AAAA;AAAA,uDAAnB,EAAwD,CAACX,MAAD,EAAiBY,IAAjB,EAAsCC,SAAtC,KAAwE;AAC5HA,YAAAA,SAAS,CAACC,QAAV,CAAmBC,GAAnB,CAAuBH,IAAI,CAACR,SAA5B,EAD4H,CAE5H;AACH,WAHD;AAIH;;AA1BqC,O","sourcesContent":["import MoveComponent from \"../components/MoveComponent\";\r\nimport NetworkReceiveComponent from \"../components/NetworkComponent\";\r\nimport TransformComponent from \"../components/TransformComponent\";\r\nimport { SystemType } from \"../framework/ECSConfig\";\r\nimport Entity from \"../framework/Entity\";\r\nimport System from \"../framework/System\";\r\nimport World from \"../framework/World\";\r\n\r\n\r\nexport class MoveSystem implements System {\r\n    world: World = null;\r\n\r\n    type: SystemType = SystemType.Physics;\r\n\r\n    onUpdate(): void {\r\n        let msgOp = this.world.getSingletonEntityComponent(NetworkReceiveComponent);\r\n\r\n        if (msgOp.msgThisLogic) {\r\n            let operations = msgOp.msgThisLogic.operations;\r\n            for (let i = 0; i < operations.length; i++) {\r\n                let op = operations[i];\r\n                let entity = this.world.getEntityByID(op.entityID);\r\n                if (entity) {\r\n                    entity.getComponent(MoveComponent).moveSpeed.set(\r\n                        op.body.dir.x * 5,\r\n                        op.body.dir.y * 5,\r\n                        op.body.dir.z * 5);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.world.forEach([MoveComponent, TransformComponent], (entity: Entity, move: MoveComponent, transform: TransformComponent) => {\r\n            transform.position.add(move.moveSpeed);\r\n            // transform.angle = move.moveSpeed.x > 0 ? 0 : (move.moveSpeed.x < 0 ? 180 : transform.angle);\r\n        });\r\n    }\r\n} "]}