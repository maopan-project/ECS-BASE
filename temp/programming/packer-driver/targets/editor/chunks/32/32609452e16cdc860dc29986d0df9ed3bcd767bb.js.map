{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/network/WSClient.ts"],"names":["_decorator","Component","log","EventCenter","ccclass","property","WSClient","ws","onLoad","instance","connect","WebSocket","onopen","ev","console","onmessage","data","obj","JSON","parse","emit","type","toString","send","msg","str","stringify"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,G,OAAAA,G;;AAEvBC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;0BAGjBM,Q,WADZF,OAAO,CAAC,UAAD,C,2BAAR,MACaE,QADb,SAC8BL,SAD9B,CACwC;AAAA;AAAA;AAAA,eAG5BM,EAH4B,GAGZ,IAHY;AAAA;;AAK1BC,QAAAA,MAAM,GAAS;AACrBF,UAAAA,QAAQ,CAACG,QAAT,GAAoB,IAApB;AACH;;AAEMC,QAAAA,OAAO,GAAG;AACbR,UAAAA,GAAG,CAAC,4BAAD,CAAH;AAEA,cAAIK,EAAE,GAAG,IAAII,SAAJ,CAAc,qBAAd,CAAT;;AACAJ,UAAAA,EAAE,CAACK,MAAH,GAAaC,EAAD,IAAsB;AAC9BC,YAAAA,OAAO,CAACZ,GAAR,CAAY,oBAAZ,EAD8B,CAE9B;AACH,WAHD;;AAKAK,UAAAA,EAAE,CAACQ,SAAH,GAAgBF,EAAD,IAAsB;AACjCX,YAAAA,GAAG,CAAC,WAAD,EAAcW,EAAE,CAACG,IAAjB,CAAH;AACA,gBAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWN,EAAE,CAACG,IAAd,CAAV;AACA;AAAA;AAAA,4CAAYP,QAAZ,CAAqBW,IAArB,CAA0BH,GAAG,CAACI,IAAJ,CAASC,QAAT,EAA1B,EAA+CL,GAA/C;AACH,WAJD;;AAMA,eAAKV,EAAL,GAAUA,EAAV;AACH;;AAEMgB,QAAAA,IAAI,CAACC,GAAD,EAAuB;AAC9B,cAAIC,GAAG,GAAGP,IAAI,CAACQ,SAAL,CAAeF,GAAf,CAAV;AACAtB,UAAAA,GAAG,CAAC,OAAD,EAAUuB,GAAV,CAAH;AAEA,eAAKlB,EAAL,CAAQgB,IAAR,CAAaE,GAAb;AACH;;AAhCmC,O,UAEtBhB,Q,GAAqB,I","sourcesContent":["import { _decorator, Component, log, Node } from 'cc';\r\nimport { GameMessageBase } from './GameMessage';\r\nimport { EventCenter } from '../event/EventCenter';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WSClient')\r\nexport class WSClient extends Component {\r\n\r\n    public static instance: WSClient = null;\r\n    private ws: WebSocket = null;\r\n\r\n    protected onLoad(): void {\r\n        WSClient.instance = this;\r\n    }\r\n\r\n    public connect() {\r\n        log(\"client try connect server!\");\r\n\r\n        let ws = new WebSocket(\"ws://localhost:8080\");\r\n        ws.onopen = (ev: MessageEvent) => {\r\n            console.log('ws connect success');\r\n            // EventCenter.instance.emit(EventDefine.EVENT_NETWORK_CONNECT);\r\n        }\r\n\r\n        ws.onmessage = (ev: MessageEvent) => {\r\n            log(\"onmessage\", ev.data);\r\n            let obj = JSON.parse(ev.data) as GameMessageBase;\r\n            EventCenter.instance.emit(obj.type.toString(), obj);\r\n        }\r\n\r\n        this.ws = ws;\r\n    }\r\n\r\n    public send(msg: GameMessageBase) {\r\n        let str = JSON.stringify(msg);\r\n        log(\"send:\", str);\r\n\r\n        this.ws.send(str);\r\n    }\r\n}\r\n\r\n\r\n"]}