{"version":3,"sources":["file:///D:/File/Cocos/ECS_Demo/assets/src/WSClient.ts"],"names":["_decorator","Component","log","eventTarget","ccclass","property","WSClient","ws","onLoad","instance","onEnable","onDisable","connect","WebSocket","onopen","ev","emit","onmessage","data","obj","JSON","parse","send","msg","str","stringify"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,G,OAAAA,G;;AACvBC,MAAAA,W,iBAAAA,W;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;0BAGjBM,Q,WADZF,OAAO,CAAC,UAAD,C,2BAAR,MACaE,QADb,SAC8BL,SAD9B,CACwC;AAAA;AAAA;AAAA,eAG5BM,EAH4B,GAGZ,IAHY;AAAA;;AAK1BC,QAAAA,MAAM,GAAS;AACrBF,UAAAA,QAAQ,CAACG,QAAT,GAAoB,IAApB;AACH;;AAESC,QAAAA,QAAQ,GAAS;AACvBR,UAAAA,GAAG,CAAC,mBAAD,EAAsB,KAAKK,EAA3B,CAAH;AACH;;AAESI,QAAAA,SAAS,GAAS;AACxBT,UAAAA,GAAG,CAAC,oBAAD,EAAuB,KAAKK,EAA5B,CAAH;AACH;;AAEMK,QAAAA,OAAO,GAAG;AACbV,UAAAA,GAAG,CAAC,4BAAD,CAAH;AAEA,cAAIK,EAAE,GAAG,IAAIM,SAAJ,CAAc,qBAAd,CAAT;;AACAN,UAAAA,EAAE,CAACO,MAAH,GAAaC,EAAD,IAAsB;AAC9B;AAAA;AAAA,4CAAYC,IAAZ,CAAiB,EAAjB;AACH,WAFD;;AAIAT,UAAAA,EAAE,CAACU,SAAH,GAAgBF,EAAD,IAAsB;AACjCb,YAAAA,GAAG,CAAC,WAAD,EAAca,EAAE,CAACG,IAAjB,CAAH;AACA,gBAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWN,EAAE,CAACG,IAAd,CAAV;AACA;AAAA;AAAA,4CAAYF,IAAZ,CAAiB,EAAjB,EAAqBG,GAArB;AACH,WAJD;;AAMA,eAAKZ,EAAL,GAAUA,EAAV;AACH;;AAEMe,QAAAA,IAAI,CAACC,GAAD,EAAuB;AAC9B,cAAIC,GAAG,GAAGJ,IAAI,CAACK,SAAL,CAAeF,GAAf,CAAV;AACArB,UAAAA,GAAG,CAAC,OAAD,EAAUsB,GAAV,CAAH;AAEA,eAAKjB,EAAL,CAAQe,IAAR,CAAaE,GAAb;AACH;;AAvCmC,O,UAEtBf,Q,GAAqB,I","sourcesContent":["import { _decorator, Component, log, Node } from 'cc';\r\nimport { eventTarget } from './GameStart';\r\nimport { GameMessageBase } from './GameMessageBase';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WSClient')\r\nexport class WSClient extends Component {\r\n\r\n    public static instance: WSClient = null;\r\n    private ws: WebSocket = null;\r\n\r\n    protected onLoad(): void {\r\n        WSClient.instance = this;\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        log(\"onEnable wsClient\", this.ws);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        log(\"onDisable wsClient\", this.ws);\r\n    }\r\n\r\n    public connect() {\r\n        log(\"client try connect server!\");\r\n\r\n        let ws = new WebSocket(\"ws://localhost:8080\");\r\n        ws.onopen = (ev: MessageEvent) => {\r\n            eventTarget.emit(\"\");\r\n        }\r\n\r\n        ws.onmessage = (ev: MessageEvent) => {\r\n            log(\"onmessage\", ev.data);\r\n            let obj = JSON.parse(ev.data);\r\n            eventTarget.emit(\"\", obj);\r\n        }\r\n\r\n        this.ws = ws;\r\n    }\r\n\r\n    public send(msg: GameMessageBase) {\r\n        let str = JSON.stringify(msg);\r\n        log(\"send:\", str);\r\n\r\n        this.ws.send(str);\r\n    }\r\n}\r\n\r\n\r\n"]}